<!doctype html>

<head>
    <meta charset="utf-8">
    <title> Test </title>
    <script type="text/javascript" src="http://cdn.webix.com/edge/webix.js"></script>
    <link rel="stylesheet" type="text/css" href="http://cdn.webix.com/edge/webix.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body>
    <script type="text/javascript" charset="utf-8">
        let profilePopup = {
            view: "popup",
            id: "my_popup",
            body: {
                view: "list",
                scroll: false,
                autoheight: true,
                data: ["Settings", "Log Out"]
            }
        };

        let toolbar = {
            view: "toolbar",
            css: "webix_dark",
            paddingX: 10,
            cols: [
                {
                    view: "label",
                    label: "My App",
                    align: "left",
                },
                {
                    view: "button",
                    css: "white_button",
                    type: "icon",
                    icon: "wxi-user",
                    label: "Profile",
                    align: "right",
                    autowidth: true,
                    popup: profilePopup
                }
            ]
        };

        let side = {
            css: "light-grey",
            rows: [
                {
                    view: "list",
                    id: "mylist",
                    css: "list",
                    width: 200,
                    scroll: false,
                    autoheight: true,
                    select: true,
                    data: ["Dashboard", "Users", "Products", "Admin"],
                    on: {
                        "onAfterSelect": function (id) {
                            $$(id).show(); //id is "Dashboard", "Users"
                        }
                    }
                },
                {},
                {
                    view: "label",
                    label: "<span class='webix_icon_btn wxi-check'></span>Connected",
                    align: "center",
                    css: "green_label"
                }
            ]
        }

        let base = {
            view: "datatable",
            id: "filmTable",
            url: "data/data.js",
            autoConfig: true,
            select:"row",
            css: "ferst_id",
            hover:"hover-table",
            on: {
                "onAfterSelect": function(id){
                    const item = this.getItem(id);
                    $$("editForm").setValues(item);
                }
            },
            columns:[
                { id:"id",
                    header:"",
                    sort:"text" },
                { id:"title",
                    header:["Film title",{content:"textFilter"}],
                    minWidth:250,
                    fillspace: true,
                    sort:"text" },
                { id:"year",
                    header:["Released",{content:"textFilter"}],
                    sort:"int" },
                { id:"votes",
                    header:["Votes",{content:"textFilter"}],
                    sort:"text" },
                { id:"rating",
                    header:["Rating",{content:"textFilter"}],
                    sort:"text" },
                { id:"rank",
                    header:["Rank",{content:"textFilter"}],
                    sort:"int" },
                { id:"del", header: "Delete", template:"{common.trashIcon()}" }
            ],
            onClick:{
                "wxi-trash":function(e, id){
                    let obj = this;
                    webix.confirm({
                        title: "Delete",
                        text: "Are you sure?",
                    }).then(function(result){
                        obj.remove(id);
                        return false;
                    });
                }
            },
        }

        let users = {
            rows: [
                {
                    autoheight: true,
                    view:"toolbar",
                    rows:[
                        {
                            view:"text",
                            id:"list_input",
                            css:"fltr",
                            on: {
                                "onTimedKeyPress": function(){
                                    let value = this.getValue().toLowerCase();
                                    $$("usersList").filter(function(obj){
                                        return obj.name.toLowerCase().indexOf(value) !== -1;
                                    })
                                }
                            }
                        }
                    ] 
                },
                {
                    view:"list",
                    url: "data/users.js",
                    id: "usersList",
                    css: "highlight",
                    select:true,
                    template:"#name# <span style='float: right' class='removeBtn webix_icon wxi-close'></span>",
                    onClick:{
                        removeBtn:function(e, id){
                            let obj = this;
                            webix.confirm({
                                title: "Delete",
                                text: "Are you sure?",
                            }).then(function(result){
                                obj.remove(id);
                                return false;
                            });
                        }
                    }
                }
            ]
        }

        let chart = {
            view:"chart",
            type:"bar",
            value:"#age#",
            barWidth:30,
            radius:0,
            url: "data/users.js",
            tooltip:{
                template:"#age#"
            },
            xAxis:{
                template:"'#age#",
                title:"Age"
            }
        };

        let form = {
            view: "form",
            id: "editForm",
            width: 300,
            elements: [
                { template: "Edit films", type: "section" },
                { view: "text", label: "Title", name: "title", invalidMessage: "Enter \"Title\"" },
                { view: "text", label: "Year", name: "year", invalidMessage: "\"Year\" should be between 1970 and current" },
                { view: "text", label: "Rating", name: "rating", invalidMessage: "\"Rating\" cannot be empty or 0" },
                { view: "text", label: "Votes", name: "votes", invalidMessage: "Enter \"Votes\" must be less than 100000" },
                { view: "text", label: "Rank", name: "rank" },
                {
                    margin: 10,
                    cols: [
                        {
                            view: "button",
                            value: "Add new",
                            type: "form",
                            click: function () {
                                if (this.getFormView().validate()) {
                                    const values = this.getFormView().getValues();
                                    if (values.id)
                                        webix.confirm({
                                            title: "Update",
                                            text: "Are you sure?",
                                        }).then(function(result){
                                            $$("filmTable").updateItem(values.id,values);
                                            this.getFormView().clear();
                                        });
                                    else
                                        webix.confirm({
                                            title: "Add",
                                            text: "Are you sure?",
                                        }).then(function(result){
                                            $$("filmTable").add(values);
                                            this.getFormView().clear();
                                        });
                                }
                            }
                        },
                        {
                            view: "button",
                            value: "Clear",
                            id: "clear",
                            click: function () {
                                let form = this.getFormView();
                                webix.confirm({
                                    title: "Delete",
                                    text: "Are you sure?",
                                }).then(function(result){
                                    form.clear();
                                    form.clearValidation();
                                });
                            }
                        }
                    ]
                },
                {}
            ],
            rules: {
                title: webix.rules.isNotEmpty,
                year: function(value){
                    return (value>1970) && (value<new Date().getFullYear());
                },
                rating: function(value){
                    return (value!=0) && (value);
                },
                votes: function(value){
                    return (value<100000);
                }
            }
        }

        let main = {
            cells: [ //try replacing cells with rows or cols
                { id: "Dashboard", cols: [base, form] },
                { id: "Users", rows: [users, chart] },
                { id: "Products", template: "Products view" },
                { id: "Admin", template: "Admin view" }
            ]
        }

        let footer = {
            view: "template",
            css: "footer",
            autoheight: true,
            template: "The software is provided by <a href=#>https://webix.com</a>. All rights reserved (c)"
        }
        webix.ui({
            rows: [
                toolbar,
                { cols: [side, { view: "resizer" }, main] },
                footer
            ]
        });

        $$("mylist").select("Dashboard");

    </script>
</body>

</html>